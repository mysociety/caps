{% extends "base.html" %}

{% load caps_templatetags %}

{% block before_content %}

<div class="council-hero">
    <div class="container-fluid">
        <a href="{% url 'council_list' %}" class="d-inline-flex align-items-center">
            {% include 'icons/chevron-left.html' with classes="mr-1" %}
            Back to all councils
        </a>
        <h1 class="mt-3 mb-0">{{ council.name }}</h1>
    </div>
</div>

{% endblock %}

{% block content %}

<div class="row">
    <div class="col-md-7 col-lg-8 order-md-2">

        <div class="card ceuk-card ceuk-card--orange mb-gutter">
            <div class="card-header">
                <h2>Declarations &amp; pledges</h2>
            </div>
            <div class="card-body">
                <h3 class="h6">Climate emergency declaration</h3>
              {% if declared_emergency %}
                    <p class="mb-0 mt-n1">
                        This council <a href="{{ declared_emergency.source_url }}">declared a climate emergency</a> on {{declared_emergency.date_declared }}.
                    </p>
              {% else %}
                    <p class="mb-0 mt-n1 text-muted">
                        We don’t think this council has declared a climate emergency – <a href="{% url 'about' %}">let us know if it has!</a>
                    </p>
              {% endif %}
              {% if promises %}
                  {% for promise in promises %}
                    <h3 class="h6 mt-4">
                      {% if promise.get_scope %}
                        {{ promise.get_scope|capfirst }} pledge
                      {% else %}
                        Climate pledge
                      {% endif %}
                      {% if promise.target_year %}
                        for {{ promise.target_year }}
                      {% endif %}
                    </h3>
                    <blockquote class="blockquote">
                        <p class="mb-0">“{{ promise.text }}”</p>
                        <footer class="blockquote-footer"><cite title="{{ promise.source_name }}"><a href="{{ promise.source }}">{{ promise.source_name }}</a></cite></footer>
                    </blockquote>
                  {% endfor %}
              {% elif no_promise %}
                    <h3 class="h6 mt-4">Climate pledges</h3>
                    <p class="mb-0 mt-n1 text-muted">
                        We couldn’t find any climate pledges from this council. If you’ve found one, <a href="{% url 'about' %}">let us know!</a>
                    </p>
              {% else %}
                    <h3 class="h6 mt-4">Climate pledges</h3>
                    <p class="mb-0 mt-n1 text-muted">
                        We haven’t checked whether this council has made any climate pledges yet, but we will soon. If you’ve already found one, <a href="{% url 'about' %}">let us know!</a>
                    </p>
              {% endif %}
            </div>
        </div>

        <div class="card ceuk-card ceuk-card--emphasised ceuk-card--red mb-gutter">
            <div class="card-header">
                <h2>Climate documents</h2>
            </div>
            <div class="card-body">
                <div class="mb-n3">
                  {% for plandocument in council.plandocument_set.all %}
                    <a href="{{ plandocument.link }}" data-plan-id="{{ plandocument.id }}" data-council-slug="{{ council.slug }}" class="d-flex align-items-center mb-3">
                      {% if plandocument.file_type == 'pdf' %}
                        {% include 'icons/pdf.html' with width='3rem' height='3rem' classes='mr-3' %}
                      {% else %}
                        {% include 'icons/file.html' with width='3rem' height='3rem' classes='mr-3' %}
                      {% endif %}
                        <div>
                            <strong class="d-block">{{ council.name }} {{ plandocument.get_document_type|title }}</strong>
                            <p class="d-inline-block text-muted mb-0">
                                {{ plandocument.file_type|upper }}
                                <span class="mx-2">&middot;</span>
                                {{ plandocument.get_status|title }}
                                <span class="mx-2">&middot;</span>
                                {{ plandocument.get_scope|title }}
                            </p>
                        </div>
                    </a>
                  {% empty %}
                    <p class="text-muted mb-3">
                        We couldn’t find any climate action plans for this council.
                    </p>
                  {% endfor %}
                </div>
            </div>
            {% if last_updated.last_update is not None %}
            <div class="card-footer">
                <div>
                    Last update: {{ last_updated.last_update }}
                </div>
            </div>
            {% endif %}
        </div>

      {% if not no_emissions_data %}
        <div class="card ceuk-card ceuk-card--purple mb-gutter">
            <div class="card-header">
                <h2>Emissions data</h2>
            </div>
            <div class="card-body">

                <div class="row justify-content-between pr-lg-3">
                    <div class="col-sm-6 col-lg-3">
                        <div class="js-sparkline mr-2">
                            <canvas width="100" height="32" data-values="{% for datapoint in council.datapoint_set.all %}{% if datapoint.data_type.name == 'Per Capita Emissions' %} {{ datapoint.value }} {% endif %}{% endfor %}"></canvas>
                        </div>
                    </div>
                    <div class="col-sm-6 col-lg-auto">
                        <span class="h3 line-height-1 mb-0">{{ latest_year_total_emissions|floatformat }}</span>
                        <abbr title="Kilotonnes of Carbon Dioxide Equivalent">ktCO2e</abbr>
                        <p>{{ latest_year }} emissions</p>
                    </div>
                    <div class="col-sm-6 col-lg-auto">
                        <span class="h3 line-height-1 mb-0">{{ latest_year_per_capita_emissions|floatformat }}</span>
                        <abbr title="Tonnes of Carbon Dioxide Equivalent">tCO2e</abbr>
                        <p>per capita</p>
                    </div>
                    <div class="col-sm-6 col-lg-auto">
                        <span class="h3 line-height-1 mb-0">{{ latest_year_per_km2_emissions|floatformat }}</span>
                        <abbr title="Kilotonnes of Carbon Dioxide Equivalent">ktCO2e</abbr>
                        <p>per km<sup>2</sup></p>
                    </div>
                </div>

                <p class="text-muted mb-0"><small>Latest CO<sub>2</sub> estimates from <a href="https://www.gov.uk/government/statistics/uk-local-authority-and-regional-carbon-dioxide-emissions-national-statistics-2005-to-2019">the Department of Business, Energy &amp; Skills</a>. County and combined authority data combined from constituent authorities.</small></p>

            </div>
        </div>
      {% endif %}

      {% if related_councils %}
        <div class="card ceuk-card ceuk-card--purple mb-gutter">
            <div class="card-header">
                <h2>Other nearby councils</h2>
            </div>
            <div class="ceuk-data-table">
                {% include 'includes/council-table.html' with councils=related_councils %}
            </div>
        </div>
      {% endif %}

    </div>
    <div class="col-md-5 col-lg-4 order-md-1">

        <div class="card ceuk-card ceuk-card--purple mb-gutter">
            <div class="card-header">
                <h2>Powers &amp; Responsibilities</h2>
            </div>
            <div class="card-body">
                {% include 'includes/council-powers.html' %}
            </div>
        </div>

        <div class="card ceuk-card ceuk-card--purple mb-gutter">
            <div class="card-header">
                <h2>More about this council</h2>
            </div>
            <div class="card-body">
                <dl class="mt-n1 mb-0">
                    <dt><a href="{{ council.website_url }}">{{ council.website_url|url_human }}{% include 'icons/external-link.html' with classes="external-link ml-1" %}</a></dt>
                    <dd>{{ council.name }}’s official homepage.</dd>
                  {% if council.twitter_url %}
                    <dt><a href="{{ council.twitter_url }}">@{{ council.twitter_name }}{% include 'icons/external-link.html' with classes="external-link ml-1" %}</a></dt>
                    <dd>{{ council.name }}’s Twitter account.</dd>
                  {% endif %}
                  {% if council.is_upper_tier is False %}
                    <dt><a href="https://carbonbudget.manchester.ac.uk/reports/{{ council.gss_code }}/" class="d-flex align-items-center" target="_blank">
                        Tyndall Centre Carbon Budget report{% include 'icons/external-link.html' with classes="external-link ml-1" %}
                    </a></dt>
                    <dd>Check {{ council.name }}’s ‘carbon budget’ – their share towards meeting the UK’s Paris agreement targets.</dd>
                  {% endif %}
                  {% if council.foe_slug != '' %}
                    <dt><a href="https://takeclimateaction.uk/near-you/{{ council.foe_slug }}" class="d-flex align-items-center" target="_blank">
                        Friends of the Earth ‘Near You’ tool{% include 'icons/external-link.html' with classes="external-link ml-1" %}
                    </a></dt>
                    <dd>Discover climate groups in this area, data about {{ council.name }}’s climate performance, and actions you can take.</dd>
                  {% endif %}
                </dl>
            </div>
        </div>

        <div class="card ceuk-card ceuk-card--muted ceuk-card--pink mb-gutter">
            <div class="card-header">
                <h2>What do you want from Climate Action Plans?</h2>
            </div>
            <div class="card-body">
                {% include 'includes/survey-email.html' %}
            </div>
        </div>

    </div>
</div>

{% endblock %}
