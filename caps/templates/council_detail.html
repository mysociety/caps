{% extends "base.html" %}

{% load humanize %}
{% load caps_templatetags %}

{% block before_content %}

<div class="council-hero">
    <div class="container-fluid">
        <a href="{% url 'council_list' %}" class="d-inline-flex align-items-center">
            {% include 'icons/chevron-left.html' with classes="mr-1" %}
            Back to all councils
        </a>
        <h1 class="mt-3 mb-0">{{ council.name }}</h1>
    </div>
</div>

{% endblock %}

{% block content %}

<div class="row">
    <div class="col-md-7 col-lg-8 order-md-2">

        <div class="card ceuk-card ceuk-card--orange mb-gutter">
            <div class="card-header">
                <h2>Declarations &amp; pledges</h2>
            </div>
            <div class="card-body">
                <h3 class="h6">Climate emergency declaration</h3>
              {% if declared_emergency %}
                    <p class="mb-0 mt-n1">
                        This council <a href="{{ declared_emergency.source_url }}">declared a climate emergency</a> on {{declared_emergency.date_declared }}.
                    </p>
              {% else %}
                    <p class="mb-0 mt-n1 text-muted">
                        We don’t think this council has declared a climate emergency – <a href="{% url 'about' %}">let us know if it has!</a>
                    </p>
              {% endif %}
              {% if promises %}
                  {% for promise in promises %}
                    <h3 class="h6 mt-4">
                      {% if promise.get_scope %}
                        {{ promise.get_scope|capfirst }} pledge
                      {% else %}
                        Climate pledge
                      {% endif %}
                      {% if promise.target_year %}
                        for {{ promise.target_year }}
                      {% endif %}
                    </h3>
                    <blockquote class="blockquote">
                        <p class="mb-0">“{{ promise.text }}”</p>
                        <footer class="blockquote-footer"><cite title="{{ promise.source_name }}"><a href="{{ promise.source }}">{{ promise.source_name }}</a></cite></footer>
                    </blockquote>
                  {% endfor %}
              {% elif no_promise %}
                    <h3 class="h6 mt-4">Climate pledges</h3>
                    <p class="mb-0 mt-n1 text-muted">
                        We couldn’t find any climate pledges from this council. If you’ve found one, <a href="{% url 'about' %}">let us know!</a>
                    </p>
              {% else %}
                    <h3 class="h6 mt-4">Climate pledges</h3>
                    <p class="mb-0 mt-n1 text-muted">
                        We haven’t checked whether this council has made any climate pledges yet, but we will soon. If you’ve already found one, <a href="{% url 'about' %}">let us know!</a>
                    </p>
              {% endif %}
            </div>
        </div>

        <div class="card ceuk-card ceuk-card--emphasised ceuk-card--red mb-gutter">
            <div class="card-header">
                <h2>Climate documents</h2>
            </div>
            <div class="card-body">
                <div class="mb-n3">
                  {% for plandocument in council.plandocument_set.all %}
                    <a href="{{ plandocument.link }}" data-plan-id="{{ plandocument.id }}" data-council-slug="{{ council.slug }}" class="d-flex align-items-center mb-3">
                      {% if plandocument.file_type == 'pdf' %}
                        {% include 'icons/pdf.html' with width='3rem' height='3rem' classes='mr-3 flex-grow-0 flex-shrink-0' %}
                      {% else %}
                        {% include 'icons/file.html' with width='3rem' height='3rem' classes='mr-3 flex-grow-0 flex-shrink-0' %}
                      {% endif %}
                        <div>
                            <strong class="d-block">{{ council.name }} {{ plandocument.get_document_type|title }}</strong>
                            <p class="d-inline-block text-muted mb-0">
                                {{ plandocument.file_type|upper }}
                                <span class="mx-2">&middot;</span>
                                {{ plandocument.get_status|title }}
                                <span class="mx-2">&middot;</span>
                                {{ plandocument.get_scope|title }}
                            </p>
                        </div>
                    </a>
                  {% empty %}
                    <p class="text-muted mb-3">
                        We couldn’t find any climate action plans for this council.
                    </p>
                  {% endfor %}
                </div>
            </div>
            {% if last_updated.last_update is not None %}
            <div class="card-footer">
                <div>
                    Last update: {{ last_updated.last_update }}
                </div>
            </div>
            {% endif %}
        </div>

      {% if not scoring_hidden %}
        <div class="card ceuk-card ceuk-card--emphasised ceuk-card--cyan mb-gutter">
            <div class="card-header">
                <h2>Climate Plan Scorecard</h2>
            </div>
            <div class="card-body d-flex align-items-center">
                {% include 'icons/info.html' with width='2rem' height='2rem' classes='mr-3 mr-lg-4 d-none d-sm-block flex-grow-0 flex-shrink-0 text-blue' %}
                <div>
                    <p class="mb-2">This council’s climate plans as of 20th September 2021 were assessed and scored by trained Climate Emergency UK volunteers, as part of the Council Climate Plan Scorecards project.</p>
                    <p class="mb-0 d-flex flex-wrap">
                        <a href="https://councilclimatescorecards.uk/councils/{{ council.slug }}/" class="d-flex align-items-center mr-4 font-weight-bold">Show the full Scorecard{% include 'icons/external-link.html' with classes="external-link ml-1" %}</a>
                        <a href="https://councilclimatescorecards.uk/methodology/" class="d-flex align-items-center mr-4">Read more about the scoring process</a>
                    </p>
                </div>
            </div>
          {% if scoring_score.weighted_total == 0 %}
            <div class="card-body d-flex align-items-center border-top scorecard-zero-scorer">
                {% include 'icons/question-circle.html' with width='2rem' height='2rem' classes='mr-3 mr-lg-4 d-none d-sm-block flex-grow-0 flex-shrink-0 text-red' %}
                <div>
                    <p class="mb-0">
                        {{ council.name }} scored <strong>zero points</strong> in this assessment. This is because the council either didn’t have any published plans at the time of the assessment, or <a href="https://councilclimatescorecards.uk/methodology/">the plans didn’t qualify</a>.
                    </p>
                </div>
            </div>
          {% endif %}
          {% if scoring_accolades %}
            <div class="card-body d-flex align-items-center border-top scorecard-top-performer-banner">
                {% include 'icons/scorecards-star.html' with width='2rem' height='2rem' classes='mr-3 mr-lg-4 d-none d-sm-block flex-grow-0 flex-shrink-0' %}
                <div>
                    <p class="mb-0 mr-lg-5">
                        {{ council.name }} was a <strong>top performer</strong>
                      {% if scoring_accolades.overall %}
                        amongst {{ scoring_group.name|lower }} councils.
                      {% elif scoring_accolades.num_sections == 1 %}
                        amongst {{ scoring_group.name|lower }} councils,
                        in the <strong>{{ scoring_accolades.example_section }}</strong> section.
                      {% else %}
                        amongst {{ scoring_group.name|lower }} councils,
                        in {{ scoring_accolades.num_sections|apnumber }} sections
                        including <strong>{{ scoring_accolades.example_section }}</strong>.
                      {% endif %}
                    </p>
                </div>
            </div>
          {% endif %}
            <div class="ceuk-data-table scorecard-table">
                <table class="table table-responsive mb-0">
                    <thead>
                        <tr>
                            <th scope="col">Section</th>
                            <th scope="col"><a href="https://councilclimatescorecards.uk/councils/{{ council.slug }}/">{{ council.name|truncatechars:40 }}{% include 'icons/external-link.html' with classes="external-link ml-1" %}</a></th>
                            <th scope="col">Average {{ scoring_group.name|lower }} council</th>
                        </tr>
                    </thead>
                    <tr class="total {% if scoring_score.top_performer %}top-performer{% endif %}">
                        <td>
                          {% if scoring_score.top_performer %}
                            <small class="d-block text-muted">Top performer</small>
                          {% endif %}
                            <span class="scorecard-table__section-name">
                                Total score
                            </span>
                        </td>
                        <td>
                            <span class="total-score total-score--this-council">
                                {{ scoring_score.weighted_total|floatformat:"0" }}%
                            </span>
                        </td>
                        <td>
                            <span class="total-score total-score--average">
                                {{ average_total|floatformat:"0" }}%
                            </span>
                        </td>
                    </tr>
                  {% for section in scoring_sections %}
                    <tr class="category-{{ forloop.counter }} {% if section.top_performer %}top-performer{% endif %}">
                        <td>
                            <small class="d-block text-muted">
                                Section {{ forloop.counter }}
                                {% if section.top_performer %}
                                  <span class="mx-1">&middot;</span> Top performer
                                {% endif %}
                            </small>
                            <span class="scorecard-table__section-name">
                                {{ section.description }}
                            </span>
                        </td>
                        <td>{% include 'scoring/includes/score-bar.html' with score=section.score max=section.max_score %}</td>
                        <td>{% include 'scoring/includes/score-bar.html' with score=section.avg max=section.max_score %}</td>
                    </tr>
                  {% endfor %}
                </table>
            </div>
        </div>
      {% endif %}

      {% if emissions_data %}
        <div class="card ceuk-card ceuk-card--purple mb-gutter">
            <div class="card-header">
                <h2>Emissions data</h2>
            </div>
            <div class="emissions-breakdown">
                <div class="emissions-breakdown__totals">
                    <div class="emissions-breakdown__stat">
                        <div>
                            <span class="h3">{{ latest_year_total_emissions|floatformat }}</span>
                            <abbr title="Kilotonnes of Carbon Dioxide">ktCO2</abbr>
                        </div>
                        <p>Total {{ latest_year }} emissions</p>
                    </div>
                    <div class="emissions-breakdown__stat">
                        <div>
                            <span class="h3">{{ latest_year_per_capita_emissions|floatformat }}</span>
                            <abbr title="Tonnes of Carbon Dioxide">tCO2</abbr>
                        </div>
                        <p>per person</p>
                    </div>
                    <div class="emissions-breakdown__stat">
                        <div>
                            <span class="h3">{{ latest_year_per_km2_emissions|floatformat }}</span>
                            <abbr title="Kilotonnes of Carbon Dioxide">ktCO2</abbr>
                        </div>
                        <p>per km<sup>2</sup></p>
                    </div>
                </div>
                <div class="emissions-breakdown__sectors">
                  {% for n, row in current_emissions_breakdown.iterrows %}
                    <div class="emissions-breakdown__stat">
                      <div>
                          <span class="h3">{{row.percentage}}</span>
                      </div>
                      <p>
                          <span class="emissions-color-chip emissions-color-chip--{{row.emissions_type|slugify}}"></span>
                          {{row.emissions_type}}
                      </p>
                    </div>
                  {% endfor %}
                </div>
            </div>
            <div class="card-body">
                {% include 'charting/includes/chart-display.html' with chart=chart_collection.multi_emissions %}
                <p class="text-muted text-smaller mt-4 mb-0">
                    Data from <a href="https://www.gov.uk/government/statistics/uk-local-authority-and-regional-carbon-dioxide-emissions-national-statistics-2005-to-2019">the Department of Business, Energy &amp; Industrial Strategy</a> “subset dataset”, representing carbon dioxide emissions within the scope of influence of local authorities.
                  {% if council.authority_type == 'CTY' or council.authority_type == 'COMB' %}
                    Data has been combined from constituent local authorities.
                  {% endif %}
                </p>

            </div>
        </div>
      {% endif %}

      {% if related_councils %}
        <div class="card ceuk-card ceuk-card--purple mb-gutter">
            <ul class="card-header nav nav-tabs" role="tablist">
              {% for group in related_councils %}
                <li class="nav-item" role="presentation">
                    <a id="{{group.type.slug}}-tab" class="nav-link {% if group.type.slug == "composite" %}active{% endif %}" href="#{{group.type.slug}}-content" aria-controls="{{group.type.slug}}-content" aria-selected="{% if group.type.slug == "composite" %}true{% else %}false{% endif %}" data-toggle="tab" role="tab">
                      {% if group.type.slug == "composite" %}
                        Similar councils
                      {% else %}
                        {{group.type.name}}
                      {% endif %}
                    </a>
                </li>
              {% endfor %}
            </ul>
            <div class="tab-content">
              {% for group in related_councils %}
                <div class="tab-pane {% if group.type.slug == "composite" %}show active{% endif %}" id="{{group.type.slug}}-content" role="tabpanel" aria-labelledby="{{group.type.slug}}-tab">
                    <div class="card-body d-flex align-items-center">
                        {% include 'icons/info.html' with width='2rem' height='2rem' classes='mr-3 mr-lg-4 d-none d-sm-block flex-grow-0 flex-shrink-0 text-blue' %}
                        <p class="mb-0">
                          {% if group.type.slug == "composite" %}
                            These councils are the most similar to <strong>{{ council.name }}</strong> in terms of emissions profile, deprivation, rural/urban population density, and geographical nearness.
                          {% elif group.type.slug == "emissions" %}
                            These councils are the most similar to <strong>{{ council.name }}</strong> in terms of their emissions profile, based on the latest data from the Department of Business, Energy &amp; Industrial Strategy.
                          {% elif group.type.slug == "geographic_distance" %}
                            These councils grographically border or overlap with <strong>{{ council.name }}</strong>.
                          {% elif group.type.slug == "imd" %}
                            These councils are the most similar to <strong>{{ council.name }}</strong> in terms of the proportion of their population living in high deprivation, medium deprivation, and low deprivation neighbourhoods.
                          {% elif group.type.slug == "ruc" %}
                            These councils are the most similar to <strong>{{ council.name }}</strong> in terms of the proportion of their population living in urban, rural, and highly rural neighbourhoods.
                          {% endif %}
                            <a href="{% url 'about_data' %}#similarity">Read more about how we calculate this.</a>
                        </p>
                    </div>
                    <div class="ceuk-data-table">
                        {% include 'includes/related-council-table.html' with councils=group.councils %}
                    </div>
                    <div class="card-footer">
                        <a href="{% url 'search_results' %}?similar_council={{ council.slug }}&amp;similar_type={{ group.type.slug }}" class="d-flex align-items-center justify-content-start">
                            {% include 'icons/search.html' with classes='mr-2' %}
                            Search inside these councils’ plans
                        </a>
                    </div>
                </div>
              {% endfor %}
            </div>
        </div>
      {% endif %}

    </div>
    <div class="col-md-5 col-lg-4 order-md-1">

      {% if tags %}
        <div class="card ceuk-card ceuk-card--purple mb-gutter">
            <div class="card-header">
                <h2>Features</h2>
            </div>
            <div class="card-body">
                <p class="mt-n1">This council’s climate plan has been tagged with the following features:</p>
                <div class="ceuk-tag-list">
                  {% for tag in tags %}
                    {% include 'includes/tag.html' with tag=tag.tag %}
                  {% endfor %}
                </div>
            </div>
        </div>
      {% endif %}

        <div class="card ceuk-card ceuk-card--purple mb-gutter">
            <div class="card-header">
                <h2>Powers &amp; Responsibilities</h2>
            </div>
            <div class="card-body">
                {% include 'includes/council-powers.html' %}
            </div>
        </div>

        <div class="card ceuk-card ceuk-card--purple mb-gutter">
            <div class="card-header">
                <h2>More about this council</h2>
            </div>
            <div class="card-body">
                <dl class="mt-n1 mb-0">
                    <dt><a href="{{ council.website_url }}">{{ council.website_url|domain_human }}{% include 'icons/external-link.html' with classes="external-link ml-1" %}</a></dt>
                    <dd>{{ council.name }}’s official homepage.</dd>
                  {% if council.twitter_url %}
                    <dt><a href="{{ council.twitter_url }}">@{{ council.twitter_name }}{% include 'icons/external-link.html' with classes="external-link ml-1" %}</a></dt>
                    <dd>{{ council.name }}’s Twitter account.</dd>
                  {% endif %}
                  {% if council.is_upper_tier is False %}
                    <dt><a href="https://carbonbudget.manchester.ac.uk/reports/{{ council.gss_code }}/" class="d-flex align-items-center" target="_blank">
                        Tyndall Centre Carbon Budget report{% include 'icons/external-link.html' with classes="external-link ml-1" %}
                    </a></dt>
                    <dd>Check {{ council.name }}’s ‘carbon budget’ – their share towards meeting the UK’s Paris agreement targets.</dd>
                  {% endif %}
                  {% if council.foe_slug != '' %}
                    <dt><a href="https://takeclimateaction.uk/near-you/{{ council.foe_slug }}" class="d-flex align-items-center" target="_blank">
                        Friends of the Earth ‘Near You’ tool{% include 'icons/external-link.html' with classes="external-link ml-1" %}
                    </a></dt>
                    <dd>Discover climate groups in this area, data about {{ council.name }}’s climate performance, and actions you can take.</dd>
                  {% endif %}
                </dl>
            </div>
        </div>

        <div class="card ceuk-card ceuk-card--muted ceuk-card--pink mb-gutter">
            <div class="card-header">
                <h2>What do you want from Climate Action Plans?</h2>
            </div>
            <div class="card-body">
                {% include 'includes/survey-email.html' %}
            </div>
        </div>

    </div>
</div>

{% endblock %}
