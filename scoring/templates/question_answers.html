{% extends "scoring/base.html" %}
{% load bootstrap4 %}

{% block content %}

<div class="container about-section question">
    <div class="row">
        <div class="col-12 col-lg-5">
            <div class="about-section-child">
                <h3 class="mb-3">About this question</h3>
                <div class="group-label-wrapper mt-5">
                    <div class="label-wrapper">
                        <p class="label green">Category</p>
                        {% comment %} TODO add section name{% endcomment %}
                        <p>add section name</p>
                    </div>
                    <div class="label-wrapper">
                        <p class="label green">Question code</p>
                        <p>{{ question.code }}</p>
                    </div>
                </div>
                <p class="mt-3">Amet minim mollit non deserunt 
                    ullamco est sit aliqua dolor do amet sint. Velit officia consequat duis enim velit mollit. Exercitation veniam consequat sunt nostrud amet.</p>
            </div>
        </div>
        <div class="col-12 col-lg-1"></div>
        <div class="col-12 col-lg-6">
            <div class="about-section-child">
                <h3 class="mb-3">Question details</h3>
                <div class="mt-5">
                    <div class="label-wrapper horizontal" style="margin-bottom:32px">
                        <p class="label green mb-2">{{ question.code }}</p>
                        <div class="question-content">{{ question.text | linebreaks }}</div>
                        <button class="btn-open-question mt-3" type="button">Display more</button>
                    </div>
                    {% comment %} TODO a list with all the subpoint questions {% endcomment %}
                    <div class="label-wrapper horizontal ml-2" style="margin-bottom:32px">
                        <p class="label is--smaller green-light mb-2">{{ question.code }}</p>
                        <div class="question-content">{{ question.text | linebreaks }}</div>
                        <button class="btn-open-question mt-3" type="button">Display more</button>
                    </div>
                    <div class="label-wrapper horizontal ml-2" style="margin-bottom:32px">
                        <p class="label is--smaller green-light mb-2">{{ question.code }}</p>
                        <div class="question-content">{{ question.text | linebreaks }}</div>
                        <button class="btn-open-question mt-3" type="button">Display more</button>
                    </div>
                    <div class="label-wrapper horizontal ml-2" style="margin-bottom:32px">
                        <p class="label is--smaller green-light mb-2">{{ question.code }}</p>
                        <div class="question-content">{{ question.text | linebreaks }}</div>
                        <button class="btn-open-question mt-3" type="button">Display more</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid question-page bg-grey-gradient question-table-section">
    <div class="mx-auto" style="max-width: 910px">
        <h3 class="mb-4 mb-lg-5">Question performance</h3>
        <div class="row bg-white mx-auto" style="max-width:100%">
            <div class="table-filter col-12 col-lg-7 py-3">
                    {% include 'scoring/includes/main-filter.html' %}
            </div>
            <div class="table-filter col-12 col-lg-5 py-3">
                <div class="float-left float-md-right">
                    {% include 'scoring/includes/advanced-filter.html' %}
                </div>
            </div>
        </div>
        <div class="row bg-white mb-4 mb-lg-5 mx-auto" style="max-width:100%">
            <div class="d-flex flex-row align-items-center px-3 p-3">
                <p class="label green mb-0 mr-2">Number of councils</p>
                <!-- TODO: Real data -->
                <p class="mb-0">XXXX on this group.</p>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="card ceuk-card ceuk-card--red mb-3 mb-md-4 mb-lg-5">
                    <div class="card-header">
                        <h3>
                            {{ question.code }}
                        </h3>
        
                        <div>
                            {{ question.text | linebreaks }}
                        </div>
                    </div>
                    <div class="ceuk-data-table">
                        <table class="table mb-0">
                            <thead>
                                <tr>
                                    <th scope="col">Council No</th>
                                    <th scope="col">Answer</th>
                                    <th scope="col">Score</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for answer in answers %}
                                <tr>
                                    <td data-column="council">
                                        {{ answer.plan_score.council.name }}
                                    </td>
                                    <td data-column="answer">
                                        {{ answer.answer }}
                                    </td>
                                    <td data-column="score">
                                        {{ answer.score }}/{{ question.max_score }}
                                    </td>
                                </tr>
                              {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
        
            </div>
        </div>
    </div>
</div>


<script>
    // Open div for each group of filters
    let questionItems = document.getElementsByClassName('question-content');
    for (let i = 0; i < questionItems.length; i++) {
        let questionItemsOffHeight = questionItems[i].offsetHeight;
        let questionItemsScrollHeight = questionItems[i].scrollHeight;
        let openDiv = questionItems[i].nextElementSibling;
        let buttonQuestion = questionItems[i].nextElementSibling;
        
        if (questionItemsOffHeight < questionItemsScrollHeight) {
            openDiv.style.display = 'inline-block';
        } else {
            openDiv.style.display = 'none';
        }
        buttonQuestion.addEventListener('click', () => {
            if(!questionItems[i].classList.contains('active')) {
                questionItems[i].classList.toggle('active');
                buttonQuestion.classList.toggle('active');
                questionItems[i].style.height = "auto";
                openDiv.textContent="Display less";
                let height = questionItems[i].clientHeight + "px";
                questionItems[i].style.height = "65px";
                setTimeout(() => {
                    questionItems[i].style.height = height;
                }, 0) 
            } else {
                questionItems[i].style.height = "65px";
                questionItems[i].addEventListener('transitionend', () => {
                    questionItems[i].classList.remove('active');
                    openDiv.textContent="Display more";
                    buttonQuestion.classList.remove('active');
                }, {once: true})
            }
        })
    }
</script>

{% endblock %}
