<button class="advanced-filter btn open-modal popup-trigger"
data-popup-trigger="one" type="button">Advanced filters</button>
<div class="advanced-filter-wrapper bg-blue-l2 popup-modal shadow" data-popup-modal="one">
    <div class="filter-header mb-4 mb-sm-5">
        <h5 class="filter-title">Select which criteria you would like to filter:</h5>
        <button class="close-icon popup-modal__close" type="button"></button>
    </div>
    <form>
        {% if authority_type == 'single' %}
        <div class="criteria-group-wrapper">
            <button class="btn-open-div mb-2" type="button">
                Nation
            </button>
            <div class="option-group open-div">
                <div class="radio-wrapper">
                    <input type="radio" id="england" name="country" value="1">
                    <label for="england">England</label>
                </div>
                <div class="radio-wrapper">
                    <input type="radio" id="scotland" name="country" value="2">
                    <label for="scotland">Scotland</label>
                </div>
                <div class="radio-wrapper">
                    <input type="radio" id="wales" name="country" value="3">
                    <label for="wales">Wales</label>
                </div>
                <div class="radio-wrapper">
                    <input type="radio" id="country_all" name="country" value=" ">
                    <label for="country_all">Any</label>
                </div>
            </div>
        </div>
        {% endif %}

        <div class="criteria-group-wrapper">
            <button class="btn-open-div mb-2" type="button">Urbanization</button>
            <div class="option-group open-div">
                {% for option in urbanisation_filter %}
                <div class="radio-wrapper">
                    <input type="radio" id="{{ option.0|slugify }}" name="ruc_cluster" value="{{ option.0 }}">
                    <label for="{{ option.0|slugify }}">{{ option.1 }}</label>
                </div>
                {% endfor %}
                <div class="radio-wrapper">
                    <input type="radio" id="urban_all" name="ruc_cluster" value="">
                    <label for="urban_all">All</label>
                </div>
            </div>
        </div>

        <div class="criteria-group-wrapper">
            <button class="btn-open-div mb-2" type="button">
                Current political control
            </button>
            <div class="option-group open-div">
                <div class="radio-wrapper">
                    <input type="radio" id="control_coalition" name="control" value="Coalition/Minority">
                    <label for="control_coalition">Coalition/Minority</label>
                </div>
                <div class="radio-wrapper">
                    <input type="radio" id="control_conservative" name="control" value="Conservative">
                    <label for="control_conservative">Conservative</label>
                </div>
                <div class="radio-wrapper">
                    <input type="radio" id="control_independant" name="control" value="Independent">
                    <label for="control_independant">Independent</label>
                </div>
                <div class="radio-wrapper">
                    <input type="radio" id="control_labour" name="control" value="Labour">
                    <label for="control_labour">Labour</label>
                </div>
                <div class="radio-wrapper">
                    <input type="radio" id="control_libdem" name="control" value="Liberal Democrat">
                    <label for="control_libdem">Liberal Democrat</label>
                </div>
                <div class="radio-wrapper">
                    <input type="radio" id="control_plaid" name="control" value="Plaid Cymru">
                    <label for="control_plaid">Plaid Cymru</label>
                </div>
                <div class="radio-wrapper">
                    <input type="radio" id="control_all" name="control" value="">
                    <label for="control_all">All</label>
                </div>
            </div>
        </div>

        <div class="criteria-group-wrapper">
            <button class="btn-open-div mb-2" type="button">
                Index of multiple deprivation
            </button>
            <div class="option-group open-div">
                <div class="radio-wrapper">
                    <input type="radio" id="imdq_1" name="imdq" value="1">
                    <label for="imdq_1">1 (most deprived)</label>
                </div>
                <div class="radio-wrapper">
                    <input type="radio" id="imdq_2" name="imdq" value="2">
                    <label for="imdq_2">2</label>
                </div>
                <div class="radio-wrapper">
                    <input type="radio" id="imdq_3" name="imdq" value="3">
                    <label for="imdq_3">3</label>
                </div>
                <div class="radio-wrapper">
                    <input type="radio" id="imdq_4" name="imdq" value="4">
                    <label for="imdq_4">4</label>
                </div>
                <div class="radio-wrapper">
                    <input type="radio" id="imdq_5" name="imdq" value="5">
                    <label for="imdq_5">5 (least deprived)</label>
                </div>
                <div class="radio-wrapper">
                    <input type="radio" id="imdq_all" name="imdq" value="">
                    <label for="imdq_all">All</label>
                </div>
            </div>
        </div>

        <div class="criteria-group-wrapper">
            <button class="btn-open-div mb-2" type="button">
                Total population
            </button>
            <div class="option-group open-div">
                {% for option in population_filter %}
                <div class="radio-wrapper">
                    <input type="radio" id="{{ option.0|slugify }}" name="population" value="{{ option.0 }}">
                    <label for="{{ option.0|slugify }}">{{ option.1 }}</label>
                </div>
                {% endfor %}
                <div class="radio-wrapper">
                    <input type="radio" id="poulation_all" name="population" value="">
                    <label for="population_all">Any</label>
                </div>
            </div>
        </div>
    </form>
</div>

<script>
    // Open div for each group of filters
    let buttonOpen = document.getElementsByClassName('btn-open-div');
    for (let i = 0; i < buttonOpen.length; i++) {
        let openDiv = buttonOpen[i].nextElementSibling;
        buttonOpen[i].addEventListener('click', () => {
            buttonOpen[i].classList.toggle('active');
            if(!openDiv.classList.contains('active')) {
                openDiv.classList.toggle('active');
                openDiv.style.height = "auto";
                let height = openDiv.clientHeight + "px";
                openDiv.style.height = "0px";
                setTimeout(() => {
                    openDiv.style.height = height;
                }, 0) 
            } else {
                openDiv.style.height = "0px";
                openDiv.addEventListener('transitionend', () => {
                    openDiv.classList.remove('active');
                }, {once: true})
            }
        })
    }
    // Display modals
    const modalTriggers = document.querySelectorAll('.popup-trigger')
    const modalCloseTrigger = document.querySelector('.popup-modal__close')
    
    modalTriggers.forEach(trigger => {
        trigger.addEventListener('click', () => {
            const { popupTrigger } = trigger.dataset;
            const popupModal = document.querySelector(`[data-popup-modal="${popupTrigger}"]`);
            popupModal.classList.add('is--visible');

            popupModal.querySelector('.popup-modal__close').addEventListener('click', () => {
            popupModal.classList.remove('is--visible');
            })
        })
    })
</script>